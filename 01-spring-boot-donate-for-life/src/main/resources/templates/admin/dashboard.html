<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Admin Dashboard - Donate4Life</title>
    <link rel="stylesheet" href="/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>

<div th:replace="~{fragments/header :: header}"></div>

<main class="main">
    <section class="profile-section">
        <div class="container">
            <div class="profile-container">
                <h2 class="form-title">Admin Dashboard</h2>
                <p class="form-description">Manage new and active blood requests and donations.</p>

                <div th:if="${success}" class="alert alert-success" th:text="${success}"></div>
                <div th:if="${param.error}" class="alert alert-danger" th:text="${param.error}"></div>
                <div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>


                <div class="history-section">
                    <h3>Donations Pending Verification</h3>
                    <div th:if="${#lists.isEmpty(unverifiedDonations)}" class="alert alert-success">
                        No new donations are pending verification.
                    </div>
                    <div th:unless="${#lists.isEmpty(unverifiedDonations)}" class="history-list">
                        <div class="history-item" style="font-weight: bold; background-color: #f8f9fa; display: flex; justify-content: space-between;">
                            <div style="flex-basis: 25%;">Donation Date</div>
                            <div style="flex-basis: 30%;">Donor Name</div>
                            <div style="flex-basis: 30%;">Hospital</div>
                            <div style="flex-basis: 15%; text-align: right;">Action</div>
                        </div>
                        <div th:each="don : ${unverifiedDonations}" class="history-item" style="display: flex; justify-content: space-between;">
                            <div style="flex-basis: 25%;" th:text="${#temporals.format(don.donationDate, 'dd-MMM-yyyy')}"></div>
                            <div style="flex-basis: 30%;" th:text="${don.donor != null ? don.donor.name : 'N/A'}"></div>
                            <div style="flex-basis: 30%;" th:text="${don.hospitalName}"></div>
                            <div style="flex-basis: 15%; text-align: right;">
                                <a th:href="@{/admin/donation/verify/{id}(id=${don.donationId})}" class="cta-button" style="padding: 0.5rem 1rem;">Verify</a>
                            </div>
                        </div>
                    </div>
                </div>

                <hr style="margin: 3rem 0; border: 1px solid #f0f0f0;">

                <div class="history-section">
                    <h3>Requests Pending Verification</h3>
                    <div th:if="${#lists.isEmpty(unverifiedRequests)}" class="alert alert-success">
                        No new requests are pending verification.
                    </div>
                    <div th:unless="${#lists.isEmpty(unverifiedRequests)}" class="history-list">
                        <div class="history-item" style="font-weight: bold; background-color: #f8f9fa; display: flex; justify-content: space-between;">
                            <div style="flex-basis: 25%;">Request Date</div>
                            <div style="flex-basis: 30%;">Acceptor Name</div>
                            <div style="flex-basis: 15%;" class="blood-group">Blood Group</div>
                            <div style="flex-basis: 15%; text-align: right;">Action</div>
                        </div>
                        <div th:each="req : ${unverifiedRequests}" class="history-item" style="display: flex; justify-content: space-between;">
                            <div style="flex-basis: 25%;" th:text="${#temporals.format(req.requestDate, 'dd-MMM-yyyy')}"></div>
                            <div style="flex-basis: 30%;" th:text="${req.acceptor != null ? req.acceptor.name : 'N/A'}"></div>
                            <div style="flex-basis: 15%;" class="blood-group" th:text="${req.requestedBloodGroup}"></div>
                            <div style="flex-basis: 15%; text-align: right;">
                                <a th:href="@{/admin/request/verify/{id}(id=${req.requestId})}" class="cta-button" style="padding: 0.5rem 1rem;">Verify</a>
                            </div>
                        </div>
                    </div>
                </div>

                <hr style="margin: 3rem 0; border: 1px solid #f0f0f0;">

                <div class="history-section">
                    <h3>Active Blood Requests</h3>
                    <div th:if="${#lists.isEmpty(activeRequests)}" class="alert alert-success">
                        There are currently no active requests needing a donor.
                    </div>
                    <div th:unless="${#lists.isEmpty(activeRequests)}" class="history-list">
                        <div class="history-item" style="font-weight: bold; background-color: #f8f9fa; display: flex; justify-content: space-between;">
                            <div style="flex-basis: 25%;">Request Date</div>
                            <div style="flex-basis: 30%;">Acceptor Name</div>
                            <div style="flex-basis: 15%;" class="blood-group">Blood Group</div>
                            <div style="flex-basis: 15%; text-align: right;">Action</div>
                        </div>
                        <div th:each="req : ${activeRequests}" class="history-item" style="display: flex; justify-content: space-between;">
                            <div style="flex-basis: 25%;" th:text="${#temporals.format(req.requestDate, 'dd-MMM-yyyy')}"></div>
                            <div style="flex-basis: 30%;" th:text="${req.acceptor != null ? req.acceptor.name : 'N/A'}"></div>
                            <div style="flex-basis: 15%;" class="blood-group" th:text="${req.requestedBloodGroup}"></div>
                            <div style="flex-basis: 15%; text-align: right;">
                                <a th:href="@{/admin/request/{id}(id=${req.requestId})}" class="cta-button" style="padding: 0.5rem 1rem;">View Details</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</main>

<div th:replace="~{fragments/footer :: footer}"></div>

<script>
    (function(){if(!window.chatbase||window.chatbase("getState")!=="initialized"){window.chatbase=(...arguments)=>{if(!window.chatbase.q){window.chatbase.q=[]}window.chatbase.q.push(arguments)};window.chatbase=new Proxy(window.chatbase,{get(target,prop){if(prop==="q"){return target.q}return(...args)=>target(prop,...args)}})}const onLoad=function(){const script=document.createElement("script");script.src="https://www.chatbase.co/embed.min.js";script.id="LvRUuDHappcxl5yRkD9n6";script.domain="www.chatbase.co";document.body.appendChild(script)};if(document.readyState==="complete"){onLoad()}else{window.addEventListener("load",onLoad)}})();
</script>

</body>
</html>